<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Game Of Life</title>
        <script type="text/javascript" src="lib/kinect.js">
        </script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript">
        </script>
        <script type="text/javascript">
            $(document).ready(function(){
            
                GOL = {
                    "gridSize": 10,
                    "grid": new Array(10),
                    "gridX": 250,
                    "gridY": 75,
                    "cellSize": 20,
                    "deadCellColor": "#00FFFF",
                    "aliveCellColor": "#000099",
					"layer" : new Kinetic.Layer() ,
					"stage" : new Kinetic.Stage("container", 800, 500)
                };
                
                init();
                
                function init(){
                    var layer = GOL.layer;
                    initializeGrid(layer);
                    initializeButtons(layer);
                    GOL.stage.add(layer);
                }
                
                function initializeGrid(layer){
                
                    var yCord = GOL.gridY;
                    $.each(GOL.grid, function(rowIndex, row){
                    
                        yCord = yCord + 20;
                        var xCord = GOL.gridX;
                        row = GOL.grid[rowIndex] = new Array(GOL.gridSize);
                        
                        $.each(row, function(colIndex, cell){
                        
                            xCord = xCord + GOL.cellSize;
                            cell = new Kinetic.Rect({
                                x: xCord,
                                y: yCord,
                                width: GOL.cellSize,
                                height: GOL.cellSize,
                                fill: GOL.deadCellColor,
                                stroke: "C8C8C8",
                                strokeWidth: 1
                            });
                            row[colIndex] = cell;
                            layer.add(cell);
                            
                            cell.on("click", function(){
                                if (this.fill == GOL.aliveCellColor) {
                                    this.fill = GOL.deadCellColor;
                                    this.alive = false;
                                }
                                else {
                                    this.fill = GOL.aliveCellColor;
                                    this.alive = true;
                                }
                                layer.draw();
                            });
                        });
                        
                    });
                }
                
                function initializeButtons(layer){
                    playButton = new Kinetic.Rect({
                        x: GOL.gridX - 130,
                        y: GOL.gridY + 150,
                        width: 100,
                        height: 50,
                        fill: "#00FFFF",
                        stroke: "C8C8C8",
                        strokeWidth: 1
                    });
                    
                    playButton.on("click", function(){
                        play();
                    });
                    layer.add(playButton);
                }
                
                function play(){
                    $.each(GOL.grid, function(row, array){
                        $.each(array, function(col, rectangle){
                            aliveNeighbours = getAliveNeighboursForCellAt(row, col);
                            if (aliveNeighbours == 2 && GOL["grid"][row][col].alive == true) {
                                rectangle.fill = GOL.aliveCellColor;
                            }
                            else 
                                if (aliveNeighbours == 3) {
                                    rectangle.fill = GOL.aliveCellColor;
                                }
                                else {
                                    rectangle.fill = GOL.deadCellColor;
                                }
                        });
                    });
                    GOL.layer.draw();
                    synchronizeGridWithDisplay();
                }
                
                function synchronizeGridWithDisplay(){
                    $.each(GOL.grid, function(row, cellArray){
                        $.each(cellArray, function(col, cell){
                            if (cell.fill == GOL.aliveCellColor) {
                                cell.alive = true
                            }
                            else {
                                cell.alive = false
                            }
                        });
                    });
                }
                function getAliveNeighboursForCellAt(row, col){
                    var aliveNeighbours = 0;
                    
                    if (neighbourAliveAt(col - 1, row - 1)) {
                        aliveNeighbours++
                    }
                    
                    if (neighbourAliveAt(col - 1, row)) {
                        aliveNeighbours++
                    }
                    
                    if (neighbourAliveAt(col - 1, row + 1)) {
                        aliveNeighbours++
                    }
                    
                    if (neighbourAliveAt(col, row - 1)) {
                        aliveNeighbours++
                    }
                    
                    if (neighbourAliveAt(col, row + 1)) {
                        aliveNeighbours++
                    }
                    
                    if (neighbourAliveAt(col + 1, row + 1)) {
                        aliveNeighbours++
                    }
                    
                    if (neighbourAliveAt(col + 1, row)) {
                        aliveNeighbours++
                    }
                    
                    if (neighbourAliveAt(col + 1, row - 1)) {
                        aliveNeighbours++
                    }
                    
                    return aliveNeighbours;
                    
                }
                
                function neighbourAliveAt(col, row){
                
                    if (col >= 0 && col < GOL.gridSize && row >= 0 && row < GOL.gridSize && GOL["grid"][row][col].alive == true) {
                        return true
                    }
                }
                
            });
        </script>
    </head>
    <body>
        <div id="container" style ="border:1px solid black">
        </div>
    </body>
</html>
